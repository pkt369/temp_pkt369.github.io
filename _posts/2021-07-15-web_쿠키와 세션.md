---
layout : posts

title : "쿠키와 세션"

date : 2021-07-15

categories : web

comments : true
---



쿠키와 세션을 이해하기 앞서서 HTTP가 가진 성질에 대해 알면 좀더 이해하기 쉽기 때문에 특징에 대해 설명하겠다.

<br>

### HTTP 특성

HTTP 특성에는

1. connectionless (비연결성)
2. stateless (무상태)

가 있다.

<br>

### 비연결성(Connectionless)

비연결성은 클라이언트와 서버가 한 번 연결을 맺은 후, 클라이언트가 요청에 대해 서버가 응답을 마치면 연결을 끊어버리는 성질을 말한다.

<br>

#### 장점

서버는 불특정한 다수에게 요청을 받는데 일일히 하나하나 다 기억하면 불필요한 많은 리소스가 사용되게 된다.

연결을 기억하지 않는다면 리소스에 이점을 가질 수 있다.

<br>

#### 단점

한번만 요청하는게 아니라 여러번 요청해야하는 경우 매번 요청에 연결을 새로 시도/해제를 반복해야 하므로, 연결/해제에 대한 오버헤드가 발생한다.

<br>

### keep-alive

단점의 해결책으로 나온 것이 keep-alive이다. 

keep-alive는 지정된 시간동안 서버와 클라이언트 사이에서 패킷 교환(긴 데이터를 나눠서 전송)이 없을경우 서로 연결을 확인하기위해 패킷을 주기적으로 보내는 것을 말한다.

<br>

주기적으로 보낸다는 것은 많은 클라이언트가 있을 경우 메모리를 많이 사용하게 되므로 완벽한 해결책은 아니다.

사용법은 헤더에 keep-alive 을 넣어서 보내면 커넥션을 재활용하게 되는데 HTTP1.1에서는 기본값이다.

<br>

### 무상태(Stateless)

서버는 클라이언트를 식별할수 없는데, 이를 Stateless라고 한다.

예를들어 로그인한 사이트에서 매번 다른 페이지를 요청할때 마다 새로운 로그인을 해야한다는 뜻이다.

여기서 필요한 것이 쿠키와 세션이다.

<br>

### 쿠키

#### 구성요소

- 이름(키) : 쿠키를 구별하는데 사용되는 이름
- 값 : 쿠키의 값
- 유효 시간 : 쿠키의 유지시간
- 도메인 : 쿠키를 전송할 도메인
- 경로 : 쿠키를 전송할 요청 경로

<br>

#### 동작 방식

1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성
3. HTTP 헤더에 쿠키를 포함시켜 응답
4. 브라우저가 종료가 되어도 쿠키 만료 시간이 있다면 클라이언트(브라우저)에서 저장하고 있음
5. 쿠키가 존재하면 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보내서 요청
6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경 할 필요가 있을 경우, 쿠키를 업데이트하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

<br>

#### 사용 예시

- 로그인 화면에서, "아이디와 비밀번호를 저장하시겠습니까?"
- 쇼핑몰의 장바구니

<br>

### 세션

세션은 쿠키를 기반으로 하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 서버에서 관리한다.

서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지한다.

또한 접속 시간에 제한을 두어 일정 시간이 없다면 세션을 끊도록 설정이 가능하다.

사용자에 대한 정보를 서버에 저장하기 때문에 쿠키보다 보안이 좋지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 된다. 즉, 동접자 수가 많은 서버의 경우 성능 저하의 요인이 된다.

<br>

#### 동작 방식

1. 클라이언트가 서버에 접속 시 세션 ID 발급
2. 클라이언트가 세션 ID에 대해 쿠키를 사용해서 저장 (이때 쿠키이름(키)은 JSESSIONID이다.)
3. 클라이언트가 서버에 다시 접속 시 이 쿠키를 이용하여 세션 ID 값을 서버에 전달

<br>

#### 특징

- 각 클라이언트에게 고유 ID를 부여
- 세션 ID로 클라이언트를 구분하여 클라이언트의 요구에 맞는 서비스를 제공
- 보안 면에서 쿠키보다 우수
- 사용자가 많아질수록 서버 메모리를 많이 차지한다.

<br>

#### 예시

로그인과 같이 보안상 중요한 작업을 수행할 때 사용

<br>

<br>

### 쿠키와 세션의 차이

쿠키와 세션은 비슷한 역할을 하며, 동작 원리도 비슷하다.

그 이유는 세션도 쿠키를 사용하기 때문이다.

<br>

가장 큰 차이점은 사용자의 기록 정보가 저장되는 위치이다. 쿠키는 서버의 자원을 전혀 사용하지 않고, 세션은 서버의 자원을 사용한다.

<br>

보안면에서 세션이 우수하며, 요청 속도는 쿠키가 세션보다 빠른데, 그 이유는 세션의 경우 서버에서의 처리가 필요하기 때문이다.

<br>

세션의 단점인 사용자 수만큼 서버 메모리를 차지하기 때문에 요즘은 이런 문제를 보완하기위해 토큰 기반의 인증방식을 사용한다. JWT 와 OAuth를 사용한다.

<br>

<br>

<br>

#### Reference

[https://interconnection.tistory.com/74](https://interconnection.tistory.com/74)

[https://victorydntmd.tistory.com/34](https://victorydntmd.tistory.com/34)



